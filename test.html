<!DOCTYPE html>
<html>
  <head>
    <script
      type="text/javascript"
      src="http://map.vworld.kr/js/vworldMapInit.js.do?version=2.0&apiKey=851B1D37-7504-38C1-98DF-52F6E03BB2CE"
    ></script>
    <meta charset="UTF-8" />
    <title>WMS API / DATA API</title>
  </head>

  <body>
    <div id="map" style="float: left; width: 800px; height: 300px"></div>
    <div style="border: 1px solid black; float: left; width: 224px">
      <form action="" id="wms_check_box">
        <ul>
          <li>
            <select id="select_wms">
              <option>선택</option>
              <option value="LT_C_UQ112">관리지역</option>
              <option value="LT_C_UQ113">농림지역</option>
              <option value="LT_C_UQ111">도시지역</option>
              <option value="LT_C_UQ114">자연환경보전지역</option>
              <option value="LT_C_UQ129">개발진흥지구</option>
              <option value="LT_C_UQ121">경관지구</option>
              <option value="LT_C_UQ123">고도지구</option>
              <option value="LT_C_UQ122">미관지구</option>
              <option value="LT_C_UQ125">방재지구</option>
              <option value="LT_C_UQ124">방화지구</option>
              <option value="LT_C_UQ126">보존지구</option>
              <option value="LT_C_UQ127">시설보호지구</option>
              <option value="LT_C_UQ128">취락지구</option>
              <option value="LT_C_UQ130">특정용도제한지구</option>
              <option value="LT_C_UD801">개발제한구역</option>
              <option value="LT_C_UQ141">국토계획구역</option>
              <option value="LT_C_UQ162">도시자연공원구역</option>
              <option value="LT_C_UM000">가축사육제한구역</option>
              <option value="LT_C_UO601">관광지</option>
              <option value="LT_C_UD610">국민임대주택</option>
              <option value="LT_C_UP401">급경사재해예방지역</option>
              <option value="LT_C_UM301">대기환경규제지역</option>
              <option value="LT_C_UF901">백두대간보호지역</option>
              <option value="LT_C_UH701">벤처기업육성지역</option>
              <option value="LT_C_UD620">보금자리주택</option>
              <option value="LT_C_UF151">산림보호구역</option>
              <option value="LT_C_UM901">습지보호지역</option>
              <option value="LT_C_UB901">시장정비구역</option>
              <option value="LT_C_UM221">야생동식물보호</option>
              <option value="LT_C_UJ401">온천지구</option>
              <option value="LT_C_UH501">유통단지</option>
              <option value="LT_C_UH402">자유무역지역지정및운영</option>
              <option value="LT_C_UD601">주거환경개선지구도</option>
              <option value="LT_C_UO101">학교환경위생정화구역</option>
              <option value="LT_C_LHZONE">사업지구경계도</option>
              <option value="LT_C_LHBLPN">토지이용계획도</option>
              <option value="LT_C_UPISUQ153">도시계획(공간시설)</option>
              <option value="LT_C_UPISUQ155">도시계획(공공문화체육시설)</option>
              <option value="LT_C_UPISUQ152">도시계획(교통시설)</option>
              <option value="LT_C_UPISUQ159">도시계획(기타기반시설)</option>
              <option value="LT_C_UPISUQ151">도시계획(도로)</option>
              <option value="LT_C_UPISUQ156">도시계획(방재시설)</option>
              <option value="LT_C_UPISUQ157">도시계획(보건위생시설)</option>
              <option value="LT_C_UPISUQ154">도시계획(유통공급시설)</option>
              <option value="LT_C_UPISUQ158">도시계획(환경기초시설)</option>
              <option value="LT_C_UPISUQ161">지구단위계획</option>
              <option value="LT_C_UPISUQ171">개발행위허가제한지역</option>
              <option value="LT_C_UPISUQ174">개발행위허가필지</option>
              <option value="LT_C_UPISUQ173">기반시설부담구역</option>
              <option value="LT_C_UPISUQ175">토지거래계약에관한허가구역</option>
              <option value="LT_C_SPBD">도로명주소건물</option>
              <option value="LT_L_SPRD">도로명주소도로</option>
              <option value="LT_C_ADSIDO">광역시도</option>
              <option value="LT_C_ADRI">리</option>
              <option value="LT_C_ADSIGG">시군구</option>
              <option value="LT_C_ADEMD">읍면동</option>
              <option value="LT_P_NSNMSSITENM">국가지명</option>
              <option value="LP_PA_CBND_BUBUN,LP_PA_CBND_BONBUN">지적도</option>
              <option value="LT_C_KFDRSSIGUGRADE">산불위험예측지도</option>
              <option value="LT_C_UP201">재해위험지구</option>
              <option value="LT_P_EDRSE002">지진대피소</option>
              <option value="LT_P_ETQSHELTER">지진해일대피소</option>
              <option value="LT_P_MGPRTFD">기타보호시설</option>
              <option value="LT_P_MGPRTFB">노인복지시설</option>
              <option value="LT_P_MGPRTFC">아동복지시설</option>
              <option value="LT_P_MGPRTFA">아동안전지킴이집</option>
              <option value="LT_C_TDWAREA">보행우선구역</option>
              <option value="LT_C_USFSFFB">소방서관할구역</option>
              <option value="LT_C_UO301">문화재보호도</option>
              <option value="LT_C_UO501">전통사찰보존</option>
              <option value="LT_L_FRSTCLIMB,LT_P_CLIMBALL">등산로</option>
              <option value="LT_L_TRKROAD,LT_P_TRKROAD">산책로</option>
              <option value="LT_L_BYCLINK">자전거길</option>
              <option value="LT_P_BYCRACKS">자전거보관소</option>
              <option value="LT_P_MOCTNODE">교통노드</option>
              <option value="LT_L_MOCTLINK">교통링크</option>
              <option value="LT_L_AISROUTEU">제한고도</option>
              <option value="LT_L_AISPATH">항공로</option>
              <option value="LT_C_AISALTC">경계구역</option>
              <option value="LT_C_AISRFLC">공중급유구역</option>
              <option value="LT_C_AISACMC">공중전투기동훈련장</option>
              <option value="LT_C_AISCTRC">관제권</option>
              <option value="LT_C_AISMOAC">군작전구역</option>
              <option value="LT_C_AISADZC">방공식별구역</option>
              <option value="LT_C_AISPRHC">비행금지구역</option>
              <option value="LT_C_AISATZC">비행장교통구역</option>
              <option value="LT_C_AISFIRC">비행정보구역</option>
              <option value="LT_C_AISRESC">비행제한구역</option>
              <option value="LT_C_AISDNGC">위험구역</option>
              <option value="LT_C_AISTMAC">접근관제구역</option>
              <option value="LT_C_AISCATC">훈련구역</option>
              <option value="LT_L_AISSEARCHL,LT_P_AISSEARCHP">
                수색비행장비행구역
              </option>
              <option value="LT_L_AISVFRPATH,LT_P_AISVFRPATH">
                시계비행로
              </option>
              <option
                value="LT_L_AISCORRID_YS,LT_L_AISCORRID_GJ,LT_P_AISCORRID_YS,LT_P_AISCORRID_GJ"
              >
                한강회랑
              </option>
              <option value="LT_P_AISHCSTRIP">헬기장</option>
              <option value="LT_P_UTISCCTV">교통CCTV</option>
              <option value="LT_C_DAMDAN">단지경계</option>
              <option value="LT_C_DAMYOJ">단지시설용지</option>
              <option value="LT_C_DAMYOD">단지용도지역</option>
              <option value="LT_C_DAMYUCH">단지유치업종</option>
              <option value="LT_C_ASITSOILDRA">배수등급</option>
              <option value="LT_C_ASITDEEPSOIL">심토토성</option>
              <option value="LT_C_ASITSOILDEP">유효토심</option>
              <option value="LT_C_ASITSURSTON">자갈함량</option>
              <option value="LT_P_SGISGOLF">골프장현황도</option>
              <option value="LT_P_SGISGWCHG">지하수측정망(오염우려지역)</option>
              <option value="LT_C_WKMBBSN">대권역</option>
              <option value="LT_C_WKMMBSN">중권역</option>
              <option value="LT_C_WKMSBSN">표준권역</option>
              <option value="LT_C_WKMSTRM">하천망</option>
              <option value="LT_P_WEISPLAFACE">기타공동처리시설</option>
              <option value="LT_P_WEISPLAFACA">농공단지처리시설</option>
              <option value="LT_P_WEISPLAFACV">마을하수도</option>
              <option value="LT_P_WEISPLAFACL">매립장침출수처리시설</option>
              <option value="LT_C_UM710">상수원보호</option>
              <option value="LT_P_WEISTACCON">수생태계조사지점</option>
              <option value="LT_P_WEISSITETB">수질자동측정망측정지점</option>
              <option value="LT_P_WEISSITEME">수질측정망공단배수지점</option>
              <option value="LT_P_WEISSITEMD">수질측정망농업용수지점</option>
              <option value="LT_P_WEISSITEMF">수질측정망도시관류지점</option>
              <option value="LT_P_WEISSITEMA">수질측정망하천수지점</option>
              <option value="LT_P_WEISSITEMB">수질측정망호소수지점</option>
              <option value="LT_P_WEISPLAFACS">축산폐수공공처리시설</option>
              <option value="LT_P_WEISPLAFACW">하수종말처리시설</option>
              <option value="LT_L_GIMSFAULT">단층</option>
              <option value="LT_C_GIMSHYDRO">수문지질단위</option>
              <option value="LT_C_GIMSSTIFF">수질다이어그램</option>
              <option value="LT_L_GIMSEC">전기전도도</option>
              <option value="LT_C_GIMSLINEA">지질구조밀도</option>
              <option value="LT_L_GIMSLINEA">지질구조선</option>
              <option value="LT_L_GIMSDEPTH">지하수등수심선</option>
              <option value="LT_L_GIMSPOTEN">지하수등수위선</option>
              <option value="LT_L_GIMSDIREC">지하수유동방향</option>
              <option value="LT_C_GIMSSCS">토양도</option>
              <option value="LT_P_RIFCT">수리시설</option>
              <option value="LT_C_RIRSV">저수지</option>
              <option value="LT_C_AGRIXUE101">농업진흥지역도</option>
              <option value="LT_C_AGRIXUE102">영농여건불리농지도</option>
              <option value="LT_C_FLISFK300">산지(보안림)</option>
              <option value="LT_C_FLISFK100">산지(자연휴양림)</option>
              <option value="LT_C_FLISFK200">산지(채종림)</option>
              <option value="LT_C_UF602">임업 및 산촌 진흥권역</option>
              <option value="LT_C_FSDIFRSTS">산림입지도</option>
              <option value="LT_C_WGISPLTALK">개발유도연안</option>
              <option value="LT_C_WGISPLROW">개발조정연안</option>
              <option value="LT_C_WGISPLUSE">이용연안</option>
              <option value="LT_C_WGISPLABS">절대보전연안</option>
              <option value="LT_C_WGISPLJUN">준보전연안</option>
              <option value="LT_C_WGISRERESH">공유수면매립3차수요조사</option>
              <option value="LT_C_WGISREPLAN">공유수면매립기본계획</option>
              <option value="LT_C_WGISRECOMP">공유수면매립준공</option>
              <option value="LT_C_WGISIEGUG">국가산업단지</option>
              <option value="LT_C_WGISIENONG">농공단지</option>
              <option value="LT_C_WGISIEILBAN">일반산업단지</option>
              <option value="LT_C_WGISIEDOSI">첨단산업단지</option>
              <option value="LT_C_WGISFMGUL">굴양식장</option>
              <option value="LT_C_WGISFMKIM">김양식장</option>
              <option value="LT_C_WGISFMDSM">다시마양식장</option>
              <option value="LT_C_WGISFMMYK">미역양식장</option>
              <option value="LT_C_WGISFMFISH">어류양식장</option>
              <option value="LT_C_WGISFMJBOK">전복양식장</option>
              <option value="LT_C_WGISTPNEWP">무역신항만</option>
              <option value="LT_C_WGISTPLAND">무역항육상구역</option>
              <option value="LT_C_WGISTPSEA">무역항해상구역</option>
              <option value="LT_C_WGISCPLAND">연안항육상구역</option>
              <option value="LT_C_WGISCPSEA">연안항해상구역</option>
              <option value="LT_C_WGISARECO">생태계경관보전지역</option>
              <option value="LT_C_WGISARFISHER">수산자원보호구역</option>
              <option value="LT_C_WGISARWET">습지보호구역</option>
              <option value="LT_C_UMA100">국립공원용도지구</option>
              <option value="LT_C_WGISNPGUG">국립자연공원</option>
              <option value="LT_C_WGISNPGUN">군립자연공원</option>
              <option value="LT_C_WGISNPDO">도립자연공원</option>
              <option value="LT_C_CDFRS100FRQ">해안침수(100년빈도)</option>
              <option value="LT_C_CDFRS150FRQ">해안침수(150년빈도)</option>
              <option value="LT_C_CDFRS200FRQ">해안침수(200년빈도)</option>
              <option value="LT_C_CDFRS050FRQ">해안침수(50년빈도)</option>
              <option value="LT_C_CDFRSMAXFRQ">해안침수(최대범람)</option>
              <option value="LT_C_TFISTIDAF,LT_P_TFISTIDAFP">갯벌정보</option>
              <option value="LT_C_TFISMPA">해양보호구역</option>
              <option value="LT_L_TOISDEPCNTAH">해안선</option>
            </select>
          </li>
        </ul>
      </form>
    </div>
    <div style="border: 1px solid RED; float: left; width: 224px">
      <form id="dataForm">
        <input
          type="hidden"
          name="key"
          value="851B1D37-7504-38C1-98DF-52F6E03BB2CE"
        />
        <input type="hidden" name="domain" value="http://localhost:4000" />
        <input type="hidden" name="service" value="data" />
        <input type="hidden" name="version" value="2.0" />
        <input type="hidden" name="request" value="getfeature" />
        <input type="hidden" name="format" value="json" />
        <input type="hidden" name="size" value="100" />
        <input type="hidden" name="page" value="1" />
        <input type="hidden" name="data" value="" />
        <input type="hidden" name="geometry" value="true" />
        <input type="hidden" name="attribute" value="true" />
        <input type="hidden" name="crs" value="EPSG:900913" />
        <input
          type="hidden"
          name="geomfilter"
          value="BOX(14028876.609587036,3912653.333809428,14151175.854843318,3974414.4526638505)"
        />
      </form>

      <ul>
        <li>
          <div>
            <span>data</span>
            <div id="data_result"></div>
          </div>
        </li>
      </ul>
    </div>

    <div style="border: 1px solid RED; float: left; width: 224px">
      <div>
        <span>범례</span>
        <div id="wms_image"></div>
      </div>
    </div>

    <script type="text/javascript">
      vw.ol3.MapOptions = {
        basemapType: vw.ol3.BasemapType.GRAPHIC,
        controlDensity: vw.ol3.DensityType.EMPTY,
        interactionDensity: vw.ol3.DensityType.BASIC,
        controlsAutoArrange: true,
        homePosition: vw.ol3.CameraPosition,
        initPosition: vw.ol3.CameraPosition,
      };

      var vmap = new vw.ol3.Map("map", vw.ol3.MapOptions);
      var view = vmap.getView();

      /* 폴리곤의 스타일 설정 */
      var vectorStyle = function (feature) {
        var style = new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: [0, 256, 0, 1],
            width: 5,
          }),
          fill: new ol.style.Fill({
            color: [256, 0, 0, 0.7],
          }),
        });
        return [style];
      };

      vmap.on("singleclick", function (evt) {
        var pixel = evt.pixel;

        if (typeof vmap.getLayerByName("wms_theme") == "object") {
          var layer = vmap.getLayerByName("wms_theme").get("id");
          if (layer.indexOf(",") > -1) {
            layer = layer.split(",")[0]; //data API는 레이어 1개씩 조회가 가능해서 2개이상이 입력될경우 변경되도록 설정(지적도)
          }
          var min = vmap.getCoordinateFromPixel([
            evt.pixel[0] - 4,
            evt.pixel[1] + 4,
          ]);
          var max = vmap.getCoordinateFromPixel([
            evt.pixel[0] + 4,
            evt.pixel[1] - 4,
          ]);
          var box = min[0] + "," + min[1] + "," + max[0] + "," + max[1];

          $("[name=geomfilter]").val("BOX(" + box + ")");
          $("[name=data]").val(layer);

          $.ajax({
            type: "get",
            url: "http://api.vworld.kr/req/data",
            data: $("#dataForm").serialize(),
            dataType: "jsonp",
            async: false,
            success: function (data) {
              var vectorSource = new ol.source.Vector({
                features: new ol.format.GeoJSON().readFeatures(
                  data.response.result.featureCollection
                ),
              });

              vmap.removeLayer(vmap.getLayerByName("search_result")); // 기존 선택된 폴리곤 삭제

              var vector_layer = new ol.layer.Vector({
                source: vectorSource,
                style: vectorStyle,
              });

              vector_layer.set("name", "search_result");
              vmap.addLayer(vector_layer);

              var resultFeature = vectorSource.getFeatures()[0];
              if (typeof resultFeature == "object") {
                var featurehtml = "";
                for (var i in resultFeature.getKeys()) {
                  featurehtml +=
                    resultFeature.getKeys()[i] +
                    " = " +
                    resultFeature.get(resultFeature.getKeys()[i]) +
                    "\n";
                }
                $("#data_result").html(featurehtml);
              }
            },

            error: function (xhr, stat, err) {},
          });
        }
      });

      /**
	오버레이 삭제
*/
      var deleteOverlay = function (id) {
        vmap.removeOverlay(map.getOverlayById(id));
      };

      $(function () {
        $(document).on("change", "#select_wms", function () {
          var this_val = $(this).val();
          var this_title = $(this).prev().text();

          vmap.removeLayer(vmap.getLayerByName("wms_theme")); //기존결과 삭제

          var layer_tile = new ol.layer.Tile({
            title: this_title,
            id: this_val,
            name: "wms_theme", //vmap 올린 레이어를 삭제하거나 수정,변경할때 접근할 name 속성
            projection: "EPSG:900913",
            extent: vmap.getView().getProjection().getExtent(), //[-20037508.34, -20037508.34, 20037508.34, 20037508.34]
            maxZoom: 18,
            minZoom: 10,
            tilePixelRatio: 1,
            tileSize: [512, 512],
            source: new ol.source.TileWMS({
              url: "http://api.vworld.kr/req/wms?",
              params: {
                LAYERS: this_val,
                STYLES: this_val,
                CRS: "EPSG:900913",
                apikey: "851B1D37-7504-38C1-98DF-52F6E03BB2CE",
                DOMAIN: "http://loacalhost:4000",
                title: this_title,
                FORMAT: "image/png",
                domain: "http://localhost:4000",
                WIDTH: 512,
                HEIGHT: 512,
              },
            }),
          });
          layer_tile.setZIndex(5);
          vmap.addLayer(layer_tile);
          var imgSrc =
            "http://api.vworld.kr/req/image?key=851B1D37-7504-38C1-98DF-52F6E03BB2CE&service=image&request=GetLegendGraphic&format=png&type=ALL&layer=" +
            this_val +
            "&style=" +
            this_val;
          $("#wms_image").html(
            "<img src='" + imgSrc + "' alt ='" + this_title + "의 범례이미지' >"
          );
        }); //'click'
      });
    </script>
  </body>
</html>
